<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ZenArt ‚Äì Tokenized Art Marketplace</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: linear-gradient(to bottom right, #e0f7fa, #fce4ec);
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 { font-size: 28px; margin-bottom: 10px; }
    .logo {
      width: 120px;
      margin: 20px auto;
      display: block;
    }
    button.connect {
      font-size: 16px; padding: 12px 24px;
      background-color: #333; color: white;
      border: none; border-radius: 6px;
      cursor: pointer; margin-bottom: 30px;
    }
    form input, form button {
      padding: 10px; margin: 8px;
      width: 80%; max-width: 400px;
      border-radius: 4px; border: 1px solid #ccc;
    }
    form button {
      background-color: #4CAF50; color: white; border: none;
    }
    .gallery {
      margin-top: 40px; max-width: 700px;
      margin-left: auto; margin-right: auto;
      text-align: left;
    }
    .art-card {
      background-color: #fff; border: 1px solid #ddd;
      border-radius: 6px; padding: 15px; margin-bottom: 15px;
    }
    .art-card img {
      max-width: 100%; border-radius: 6px; margin-top: 10px;
    }
    .chart-container {
      margin-top: 50px; max-width: 600px;
      margin-left: auto; margin-right: auto;
    }
  </style>
</head>
<body>
  <button class="connect" onclick="connectWallet()">üîó Connect Wallet</button>
  <img src="assets/zenchain-logo.png" alt="ZenChain Logo" class="logo">
  <h1>ZenArt</h1>
  <p>Welcome to ZenArt! Connect your MetaMask wallet to get started.</p>

  <form id="artForm">
    <h2>Register New Artwork</h2>
    <input type="text" id="title" placeholder="Artwork Title" required><br>
    <input type="text" id="artistName" placeholder="Artist Name" required><br>
    <input type="text" id="description" placeholder="Description" required><br>
    <input type="text" id="ipfsHash" placeholder="IPFS Image Hash" required><br>
    <button type="submit">Register</button>
  </form>

  <div class="gallery" id="gallery">
    <h2>üìÅ Gallery</h2>
    <div id="artworks"></div>
  </div>

  <div class="chart-container">
    <h2>üìä Popularity Chart</h2>
    <canvas id="popularityChart"></canvas>
  </div><script>
const contractAddress = "0xD0AB46ccFDdd3DF6fDaae30Eb00ea39C904d38F3";
const contractABI = [
  {
    "inputs": [
      { "internalType": "string", "name": "_title", "type": "string" },
      { "internalType": "string", "name": "_artistName", "type": "string" },
      { "internalType": "string", "name": "_description", "type": "string" },
      { "internalType": "string", "name": "_ipfsHash", "type": "string" }
    ],
    "name": "registerArtwork",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [{ "internalType": "uint256", "name": "_artworkId", "type": "uint256" }],
    "name": "likeArtwork",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [{ "internalType": "uint256", "name": "_artworkId", "type": "uint256" }],
    "name": "signArtwork",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "uint256", "name": "_artworkId", "type": "uint256" },
      { "internalType": "address", "name": "_newOwner", "type": "address" }
    ],
    "name": "transferArtwork",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "totalArtworks",
    "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [{ "internalType": "uint256", "name": "_artworkId", "type": "uint256" }],
    "name": "getArtwork",
    "outputs": [
      { "internalType": "string", "name": "title", "type": "string" },
      { "internalType": "string", "name": "artistName", "type": "string" },
      { "internalType": "string", "name": "description", "type": "string" },
      { "internalType": "string", "name": "ipfsHash", "type": "string" },
      { "internalType": "address", "name": "currentOwner", "type": "address" },
      { "internalType": "uint256", "name": "likes", "type": "uint256" },
      { "internalType": "address[]", "name": "signers", "type": "address[]" }
    ],
    "stateMutability": "view",
    "type": "function"
  }
];

let web3;
let zenArtContract;
let userAddress = null;

async function connectWallet() {
  if (window.ethereum) {
    web3 = new Web3(window.ethereum);
    try {
      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      userAddress = accounts[0];
      zenArtContract = new web3.eth.Contract(contractABI, contractAddress);
      alert("‚úÖ Wallet connected: " + userAddress);
      loadArtworks();
    } catch (error) {
      alert("‚ùå Wallet connection failed.");
    }
  } else {
    alert("‚ùå MetaMask not detected.");
  }
}

document.getElementById('artForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const title = document.getElementById('title').value;
  const artistName = document.getElementById('artistName').value;
  const description = document.getElementById('description').value;
  const ipfsHash = document.getElementById('ipfsHash').value;

  try {
    const receipt = await zenArtContract.methods.registerArtwork(title, artistName, description, ipfsHash)
      .send({ from: userAddress });

    if (receipt.status) {
      alert("‚úÖ Artwork registered.");
      document.getElementById('artForm').reset();
      setTimeout(loadArtworks, 2000);
    } else {
      alert("‚ùå Transaction failed.");
    }
  } catch (error) {
    console.error("Registration error:", error);
    alert("‚ùå Registration failed.");
  }
});

async function loadArtworks() {
  const container = document.getElementById('artworks');
  container.innerHTML = "";
  const labels = [];
  const likeCounts = [];

  try {
    const total = await zenArtContract.methods.totalArtworks().call();
    for (let i = 0; i < total; i++) {
      const art = await zenArtContract.methods.getArtwork(i).call();
      labels.push(art.title);
      likeCounts.push(art.likes);

      const card = document.createElement('div');
      card.className = "art-card";
      card.innerHTML = `
        <h3>${art.title}</h3>
        <p><strong>Artist:</strong> ${art.artistName}</p>
        <p>${art.description}</p>
        <img src="https://ipfs.io/ipfs/${art.ipfsHash}" alt="Artwork Image" />
        <p><strong>Owner:</strong> ${art.currentOwner}</p>
        <p><strong>Likes:</strong> ${art.likes}</p>
        <p><strong>Signers:</strong> ${art.signers.length}</p>
        <button onclick="likeArtwork(${i})">‚ù§Ô∏è Like</button>
        <button onclick="signArtwork(${i})">‚úçÔ∏è Sign</button>
        <button onclick="transferArtwork(${i})">üîÅ Transfer</button>
      `;
      container.appendChild(card);
    }

    renderChart(labels, likeCounts);
  } catch (error) {
    console.error("Error loading artworks:", error);
  }
}

async function likeArtwork(id) {
  try {
    await zenArtContract.methods.likeArtwork(id).send({ from: userAddress });
    alert("‚ù§Ô∏è Liked!");
    loadArtworks();
  } catch (error) {
    alert("‚ùå Like failed.");
  }
}

async function signArtwork(id) {
  try {
    await zenArtContract.methods.signArtwork(id).send({ from: userAddress });
    alert("‚úçÔ∏è Signed!");
    loadArtworks();
  } catch (error) {
    alert("‚ùå Sign failed.");
  }
}

async function transferArtwork(id) {
  const to = prompt("Enter recipient address:");
  if (!to) return;
  try {
    await zenArtContract.methods.transferArtwork(id, to).send({ from: userAddress });
    alert("üîÅ Transferred!");
    loadArtworks();
  } catch (error) {
    alert("‚ùå Transfer failed.");
  }
}

function renderChart(labels, data) {
  const ctx = document.getElementById('popularityChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Likes per Artwork',
        data: data,
        backgroundColor: '#4CAF50'
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}

window.addEventListener('load', () => {
  console.log("ZenArt loaded.");
});
</script>
</body>
</html>
