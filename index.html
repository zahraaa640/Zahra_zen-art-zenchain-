<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZenArt – Tokenized Art Marketplace</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #ffffff;
      color: #000;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    .logo {
      margin: 20px auto;
      display: block;
      max-width: 200px;
    }
    .logo-bottom {
      margin: 40px auto 0;
      display: block;
      max-width: 100%;
    }
    .container {
      width: 90%;
      max-width: 600px;
      margin: auto;
    }
    input {
      margin: 10px 0;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 100%;
      font-size: 16px;
    }
    button {
      background: #00cc66;
      border: none;
      color: white;
      padding: 14px;
      margin: 10px 0;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      width: 100%;
      transition: 0.2s;
    }
    button:hover {
      background: #00994d;
    }
    h2, h3 {
      margin: 15px 0;
    }
    .output {
      margin-top: 15px;
      text-align: left;
      font-size: 14px;
      background: #f4f4f4;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 10px;
      text-align: left;
    }
    th {
      background: #e0e0e0;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>

  <!-- لوگوی بالایی -->
  <img src="IMG_20251005_132202_322.jpg" alt="ZenChain Logo" class="logo" />

  <div class="container">
    <h2>Welcome to ZenArt</h2>

    <!-- اتصال ولت -->
    <button id="connectButton">Connect Wallet</button>
    <div id="walletAddress"></div>

    <!-- ثبت اثر هنری -->
    <h3>Register Artwork</h3>
    <input id="title" type="text" placeholder="Artwork Title" />
    <input id="artistName" type="text" placeholder="Artist Name" />
    <input id="description" type="text" placeholder="Description" />
    <input id="imageHash" type="text" placeholder="IPFS Hash" />
    <button onclick="registerArtwork()">Register</button>

    <!-- امضا -->
    <h3>Sign Artwork</h3>
    <input id="signHash" type="text" placeholder="Enter IPFS Hash" />
    <button onclick="signArtwork()">Sign</button>

    <!-- گالری -->
    <h3>Gallery</h3>
    <div id="gallery" class="output"></div>

    <!-- جدول امضا -->
    <h3>Signature Table</h3>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Title</th>
          <th>Signers</th>
        </tr>
      </thead>
      <tbody id="signatureTable">
      </tbody>
    </table>
  </div>

  <!-- لوگوی پایینی -->
  <img src="IMG_20251005_132202_322.jpg" alt="ZenChain Logo" class="logo-bottom" />

  <script>
    // آدرس قرارداد و ABI کامل
    const contractAddress = "0x358AA13c52544ECCEF6B0ADD0f801012ADAD5eE3";
    const contractABI = [
      {
        "inputs":[{"internalType":"string","name":"_imageHash","type":"string"},
                  {"internalType":"string","name":"_description","type":"string"},
                  {"internalType":"string","name":"_artistName","type":"string"}],
        "name":"registerArtwork",
        "outputs":[],
        "stateMutability":"nonpayable",
        "type":"function"
      },
      {
        "inputs":[{"internalType":"uint256","name":"_artworkId","type":"uint256"}],
        "name":"signArtwork",
        "outputs":[],
        "stateMutability":"nonpayable",
        "type":"function"
      },
      {
        "inputs":[{"internalType":"uint256","name":"","type":"uint256"}],
        "name":"artworks",
        "outputs":[
          {"internalType":"uint256","name":"id","type":"uint256"},
          {"internalType":"string","name":"imageHash","type":"string"},
          {"internalType":"string","name":"description","type":"string"},
          {"internalType":"string","name":"artistName","type":"string"},
          {"internalType":"address","name":"creator","type":"address"},
          {"internalType":"uint256","name":"timestamp","type":"uint256"}],
        "stateMutability":"view",
        "type":"function"
      },
      {
        "inputs":[{"internalType":"uint256","name":"_artworkId","type":"uint256"}],
        "name":"getArtwork",
        "outputs":[
          {"internalType":"uint256","name":"id","type":"uint256"},
          {"internalType":"string","name":"imageHash","type":"string"},
          {"internalType":"string","name":"description","type":"string"},
          {"internalType":"string","name":"artistName","type":"string"},
          {"internalType":"address","name":"creator","type":"address"},
          {"internalType":"uint256","name":"timestamp","type":"uint256"}],
        "stateMutability":"view",
        "type":"function"
      },
      {
        "inputs":[],
        "name":"nextArtworkId",
        "outputs":[{"internalType":"uint256","name":"","type":"uint256"}],
        "stateMutability":"view",
        "type":"function"
      },
      {
        "inputs":[{"internalType":"uint256","name":"_artworkId","type":"uint256"}],
        "name":"getOwnershipHistory",
        "outputs":[{"internalType":"address[]","name":"","type":"address[]"}],
        "stateMutability":"view",
        "type":"function"
      }
    ];

    let web3;
    let contract;
    let accounts;

    async function connectWallet() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        try {
          accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
          contract = new web3.eth.Contract(contractABI, contractAddress);
          document.getElementById("walletAddress").innerText =
            "Connected: " + accounts[0];
          document.getElementById("connectButton").innerText = "Wallet Connected";
        } catch (err) {
          alert("Connection error: " + err.message);
        }
      } else {
        alert("MetaMask not found! Please install it.");
      }
    }

    async function registerArtwork() {
      const imageHash = document.getElementById("imageHash").value;
      const description = document.getElementById("description").value;
      const artistName = document.getElementById("artistName").value;

      await contract.methods
        .registerArtwork(imageHash, description, artistName)
        .send({ from: accounts[0] });
      alert("Artwork registered!");
      loadGallery();
    }

    async function signArtwork() {
      const hash = document.getElementById("signHash").value;
      // باید با جستجو ID پیدا بشه، فعلا ساده فرض شده id=0
      const id = 0;
      await contract.methods.signArtwork(id).send({ from: accounts[0] });
      alert("Artwork signed!");
      loadSignatures();
    }

    async function loadGallery() {
      const nextId = await contract.methods.nextArtworkId().call();
      let galleryHtml = "";
      for (let i = 0; i < nextId; i++) {
        const art = await contract.methods.getArtwork(i).call();
        galleryHtml += `<div><strong>${art.artistName}</strong> - ${art.description} (IPFS: ${art.imageHash})</div>`;
      }
      document.getElementById("gallery").innerHTML = galleryHtml;
    }

    async function loadSignatures() {
      const nextId = await contract.methods.nextArtworkId().call();
      let tableHtml = "";
      for (let i = 0; i < nextId; i++) {
        const art = await contract.methods.getArtwork(i).call();
        const signers = await contract.methods.getOwnershipHistory(i).call();
        tableHtml += `<tr><td>${i}</td><td>${art.description}</td><td>${signers.join(", ")}</td></tr>`;
      }
      document.getElementById("signatureTable").innerHTML = tableHtml;
    }

    document.getElementById("connectButton").addEventListener("click", connectWallet);
  </script>
</body>
</html>
