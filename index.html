<!DOCTYPE html>
<html>
<head>
  <title>ZenArt ‚Äì Tokenized Art Market</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button { margin: 5px; padding: 8px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  </style>
</head>
<body>
  <h1>ZenArt ‚Äì Tokenized Art Market</h1>
  <button onclick="connectWallet()">üîó Connect Wallet</button>
  <p id="walletStatus">Wallet not connected</p>

  <h2>üé® Register New Artwork</h2>
  <input id="title" placeholder="Artwork Title" />
  <input id="artist" placeholder="Artist Name" />
  <input id="description" placeholder="Description" />
  <input id="imageURL" placeholder="IPFS Hash" />
  <button onclick="registerArtwork()">Register</button>

  <h2>üñãÔ∏è Sign Artwork</h2>
  <input id="artworkId" placeholder="Artwork ID to Sign" />
  <button onclick="signArtwork()">Sign</button>

  <h2>üñºÔ∏è Gallery</h2>
  <div id="gallery"></div>

  <h2>üìã Signature Table</h2>
  <table id="signatureTable">
    <thead>
      <tr>
        <th>Artwork ID</th>
        <th>Title</th>
        <th>Signers</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const contractAddress = "0xe736616Bb6E6Df6e75fE957D77f406AfDC9D3C9B";
    const abi = [
  {
    "anonymous": false,
    "inputs": [
      { "indexed": true, "internalType": "uint256", "name": "id", "type": "uint256" },
      { "indexed": true, "internalType": "address", "name": "owner", "type": "address" }
    ],
    "name": "ArtworkRegistered",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      { "indexed": true, "internalType": "uint256", "name": "id", "type": "uint256" },
      { "indexed": true, "internalType": "address", "name": "signer", "type": "address" }
    ],
    "name": "ArtworkSigned",
    "type": "event"
  },
  {
    "inputs": [
      { "internalType": "string", "name": "_title", "type": "string" },
      { "internalType": "string", "name": "_description", "type": "string" },
      { "internalType": "string", "name": "_imageURL", "type": "string" },
      { "internalType": "string", "name": "_artist", "type": "string" }
    ],
    "name": "registerArtwork",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "uint256", "name": "_id", "type": "uint256" }
    ],
    "name": "signArtwork",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "uint256", "name": "", "type": "uint256" }
    ],
    "name": "artworks",
    "outputs": [
      { "internalType": "string", "name": "title", "type": "string" },
      { "internalType": "string", "name": "description", "type": "string" },
      { "internalType": "string", "name": "imageURL", "type": "string" },
      { "internalType": "string", "name": "artist", "type": "string" },
      { "internalType": "address", "name": "owner", "type": "address" },
      { "internalType": "uint256", "name": "timestamp", "type": "uint256" },
      { "internalType": "uint256", "name": "likes", "type": "uint256" }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "getAllArtworks",
    "outputs": [
      {
        "components": [
          { "internalType": "string", "name": "title", "type": "string" },
          { "internalType": "string", "name": "description", "type": "string" },
          { "internalType": "string", "name": "imageURL", "type": "string" },
          { "internalType": "string", "name": "artist", "type": "string" },
          { "internalType": "address", "name": "owner", "type": "address" },
          { "internalType": "uint256", "name": "timestamp", "type": "uint256" },
          { "internalType": "uint256", "name": "likes", "type": "uint256" }
        ],
        "internalType": "struct ZenArt.Artwork[]",
        "name": "",
        "type": "tuple[]"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "uint256", "name": "_id", "type": "uint256" }
    ],
    "name": "getArtworkById",
    "outputs": [
      { "internalType": "string", "name": "title", "type": "string" },
      { "internalType": "string", "name": "description", "type": "string" },
      { "internalType": "string", "name": "imageURL", "type": "string" },
      { "internalType": "string", "name": "artist", "type": "string" },
      { "internalType": "address", "name": "owner", "type": "address" },
      { "internalType": "uint256", "name": "timestamp", "type": "uint256" },
      { "internalType": "uint256", "name": "likes", "type": "uint256" }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "getArtworkCount",
    "outputs": [
      { "internalType": "uint256", "name": "", "type": "uint256" }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "uint256", "name": "_id", "type": "uint256" }
    ],
    "name": "getSigners",
    "outputs": [
      { "internalType": "address[]", "name": "", "type": "address[]" }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "uint256", "name": "", "type": "uint256" },
      { "internalType": "address", "name": "", "type": "address" }
    ],
    "name": "hasSigned",
    "outputs": [
      { "internalType": "bool", "name": "", "type": "bool" }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "uint256", "name": "", "type": "uint256" },
      { "internalType": "uint256", "name": "", "type": "uint256" }
    ],
    "name": "signatures",
    "outputs": [
      { "internalType": "address", "name": "", "type": "address" }
    ],
    "stateMutability": "view",
    "type": "function"
  }
];

    let provider, signer, contract;

    async function connectWallet() {
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      contract = new ethers.Contract(contractAddress, abi, signer);
      const address = await signer.getAddress();
      document.getElementById("walletStatus").innerText = `Connected: ${address}`;
      loadArtworks();
    }

    async function registerArtwork() {
      const title = document.getElementById("title").value;
      const artist = document.getElementById("artist").value;
      const description = document.getElementById("description").value;
      const imageURL = document.getElementById("imageURL").value;
      await contract.registerArtwork(title, description, imageURL, artist);
      alert("Artwork registered!");
      loadArtworks();
    }

    async function signArtwork() {
      const id = document.getElementById("artworkId").value;
      await contract.signArtwork(id);
      alert("Artwork signed!");
      loadArtworks();
    }

    async function loadArtworks() {
      const artworks = await contract.getAllArtworks();
      const gallery = document.getElementById("gallery");
      const tableBody = document.querySelector("#signatureTable tbody");
      gallery.innerHTML = "";
      tableBody.innerHTML = "";

      for (let i = 0; i < artworks.length; i++) {
        const art = artworks[i];
        const signers = await contract.getSigners(i);

        const card = document.createElement("div");
        card.innerHTML = `
          <h3>${art.title} (#${i})</h3>
          <p><strong>Artist:</strong> ${art.artist}</p>
          <p><strong>Description:</strong> ${art.description}</p>
          <p><strong>Likes:</strong> ${art.likes}</p>
          <img src="https://ipfs.io/ipfs/${art.imageURL}" width="200" />
          <hr/>
        `;
        gallery.appendChild(card);

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${i}</td>
          <td>${art.title}</td>
          <td>${signers.join("<br/>")}</td>
        `;
        tableBody.appendChild(row);
      }
    }

    window.onload = () => {
      if (window.ethereum) {
        connectWallet();
      } else {
        alert("Please install MetaMask to use ZenArt.");
      }
    };
  </script>
</body>
</html>
